<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="never"> 
    <title>Document</title>
</head>
<style>
    * {
        padding: 0;
        margin: 0;
    }

    #banner {
        width: 600px;
        /* height: 300px; */
        /* overflow: hidden; */
        margin: 0 auto;
        background-color: rgb(201, 199, 199);
    }

    #banner .hid {
        width: 600px;
        height: 300px;
        overflow: hidden;
    }

    .box {
        width: 600px;
        height: 300px;
        margin: 0 auto;
        display: -webkit-box;
    }

    .box>div {
        width: 600px;
        height: 300px;
        /* border: 2px solid black; */
    }

    .box>div>img {
        width: 100%;
        height: auto;
    }

    .but {

        width: 600px;
        height: 600px;
        margin-top: 20px;

    }

    .but>div {
        float: left;
        width: 180px;
        height: 150px;
        margin-left: 15px;
        /* border: 1px solid red; */
    }

    .but>div>img {
        width: 100%;
        height: auto;
    }

    .navigation {
        width: 600px;
        height: 40px;
        background-color: black;
        color: white;
        display: flex;
        justify-content: space-evenly;
    }

    .navigation>span {
        line-height: 40px;
    }
</style>

<body>
    <div id="banner">
        <div class="hid">
            <div class="box">

            </div>
        </div>
        <div class="navigation">
            <!-- <span>热血</span>
            <span>古装</span>
            <span>玄幻</span>
            <span>都市</span>
            <span>历史</span>
            <span>生活</span>
            <span>青春</span>
            <span>现代</span>
            <span>恐怖</span> -->
        </div>

        <div class="but">
            <!-- <div><img src="" alt=""></div>
            <div><img src="" alt=""></div>
            <div><img src="" alt=""></div>
            <div><img src="" alt=""></div>
            <div><img src="" alt=""></div> -->

        </div>
    </div>
    <script src="./jquery-3.6.0.min.js"></script>
    <script>
        /*
          url
          data post请求的参数
          methodType
          cb
          timeout 超时时间 
         */
        function ajax(option) {

            return new Promise((resolve, reject) => {
                option = Object.assign({
                    timeout: 5000,
                    type: 'GET'
                }, option)

                var data = option.data  // {name: 123, age: 5} => 'name=123&age=5'

                var dataStr = ''

                for (var key in data) {
                    dataStr += key + '=' + data[key] + '&'
                }
                // 去掉多余的&
                dataStr = dataStr.substring(0, dataStr.length - 1)

                var xhr = new XMLHttpRequest()

                var timer = setTimeout(function () {
                    // 超时
                    reject('网络超时')
                    xhr.abort()
                }, option.timeout)

                xhr.onreadystatechange = function () {

                    if (xhr.readyState == 4) {
                        clearTimeout(timer)
                        if (xhr.status == 200) {
                            // 请求成功获取数据
                            // 获取文本数据 
                            resolve(xhr.responseText)
                        } else {
                            reject(xhr.responseText)
                        }
                    }
                }


                xhr.open(option.type, option.url)

                if (option.type === 'POST') {
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
                }

                xhr.send(dataStr)
            })
        }

        ajax({
            type: 'GET',
            url: 'https://apis.netstart.cn/bcomic/Banner',
        }).then(
            data => {
                data = JSON.parse(data)
                let divimg = document.querySelector(".box")

                let img = data.data
                // console.log(img);
                // 渲染
                divimg.innerHTML = img.map(item => `
                    <div><img src='${item.img}' alt=""></div>
               ` ).join("");

                let bannerW = $("#banner")[0].offsetWidth;
                function goto(idx) {
                    $(".box").stop().animate({
                        marginLeft: -bannerW * idx
                    })
                }
                let currentIndex = 0;
                let timer = null
                if (timer === null) {
                    timer = setInterval(() => {
                        currentIndex++;
                        currentIndex = currentIndex % 3;
                        goto(currentIndex);
                    }, 2000);
                }
                $(".hid").hover(() => {
                    clearInterval(timer);
                    timer = null;
                }, () => {
                    if (timer === null) {
                        timer = setInterval(() => {
                            currentIndex++;
                            currentIndex = currentIndex % 3;
                            goto(currentIndex);
                        }, 2000);
                    }
                });
            }
        )

        ajax({
            type: 'GET',
            url: 'https://apis.netstart.cn/bcomic/HomeRecommend',

        }).then(data => {
            // return new Promise()
            data = JSON.parse(data)
            let dataImg = data.data.list
            console.log(dataImg);
            let hmImg = document.querySelector(".but")
            hmImg.innerHTML = dataImg.map(item => `
            <div><img src="${item.img}" alt=""><span>${item.title}</span></div>
            `).join("")


            let arr = ["热血", "古装", "玄幻", "都市", "历史", "生活", "青春", "现代", "恐怖"]
            let newArr = document.querySelector(".navigation")

            newArr.innerHTML = arr.map(item =>
                `
                <span>${item}</span>      
                
                `
            ).join("")


        })


    </script>
</body>

</html>